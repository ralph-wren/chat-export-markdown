# 插件面板状态卡住问题修复说明 (2026-01-24)

## 问题描述
用户反馈在触发发布流程（如发布到小红书）后，重新打开插件面板时，页面依然显示“正在生成文章”或“正在准备发布”，进度条卡在 95%。

## 原因分析
在 [index.ts](file:///c:/Users/ralph/IdeaProject/Memoraid/src/background/index.ts) 中，当用户从生成结果页面点击“发布”按钮时，会向后台发送 `PUBLISH_TO_XIAOHONGSHU` 等消息。
后台在处理这些消息时，调用了 `handlePublishToXiaohongshu` 等函数。这些函数会更新 `currentTask` 状态为“正在准备发布”，但由于这是一个异步过程且在消息处理函数中没有后续的清理逻辑，导致 `currentTask` 状态一直保留在内存和本地存储中。

## 修复方案
在 [index.ts](file:///c:/Users/ralph/IdeaProject/Memoraid/src/background/index.ts) 的消息监听器中，为所有发布相关的消息（微信、小红书、今日头条、知乎）增加了 `.then()` 回调。
当发布操作成功触发（即打开了对应平台的发布页面并存入待填充数据）后，显式清除 `currentTask` 状态并通知 UI 更新。

## 更改详情
- **[index.ts](file:///c:/Users/ralph/IdeaProject/Memoraid/src/background/index.ts)**:
    - 修改了 `PUBLISH_TO_WEIXIN` 的处理逻辑。
    - 修改了 `PUBLISH_TO_XIAOHONGSHU` 的处理逻辑。
    - 补充了 `PUBLISH_TO_TOUTIAO` 和 `PUBLISH_TO_ZHIHU` 的消息处理及状态清除逻辑。

## 验证结果
- 执行 `npm run build` 编译成功。
- 该更改确保了无论发布流程是否成功打开页面，插件面板在操作完成后都会回到初始状态或显示已保存的历史记录，而不会卡在“处理中”。
