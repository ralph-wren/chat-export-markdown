# 修复关闭面板中断文章生成的问题

## 问题描述
用户反馈在点击生成知乎/头条/公众号文章时，如果此时还在抓取文章内容或正在生成中，关闭扩展面板（Popup）会导致后续流程（生成文章、跳转发布）中断。

这是因为 Chrome 扩展的 Popup 页面一旦关闭，其运行的 JavaScript 上下文就会立即销毁，所有未完成的异步任务都会被终止。

## 解决方案
将核心业务流程（抓取 -> 生成 -> 发布）从 Popup 迁移到 Background Service Worker 中。Service Worker 的生命周期独立于 Popup，即使 Popup 关闭，Service Worker 仍然可以继续运行（只要保持活跃）。

### 1. Background Script 更新
- 在 `src/background/index.ts` 中新增 `INITIATE_GENERATE_AND_PUBLISH` 消息处理器。
- 封装 `handleInitiateProcess` 函数，负责协调整个流程：
  1. 向 Content Script 发送 `EXTRACT_CONTENT` 指令进行抓取。
  2. 接收抓取结果。
  3. 调用 `startArticleGenerationAndPublish` 进行 AI 生成和跳转发布。
- 在流程各阶段通过 `updateTaskState` 更新任务状态到 `chrome.storage.local`，以便 Popup 重新打开时能恢复显示进度。

### 2. Popup 更新
- 修改 `src/components/Home.tsx` 中的 `handleGenerateAndPublishTo...` 系列函数。
- 不再在前端等待抓取结果，而是直接发送 `INITIATE_GENERATE_AND_PUBLISH` 消息给 Background，并立即让出控制权。
- UI 状态依赖现有的 `chrome.storage.local` 监听机制 (`updateFromTask`) 自动更新，无需额外修改。

## 验证方法
1. 打开任意文章页面。
2. 点击"发布到知乎/头条/公众号"。
3. 看到进度条出现后，立即关闭扩展面板。
4. 等待片刻（约30-60秒）。
5. 观察是否会自动打开目标平台的发布页面并填充内容。
6. 重新打开扩展面板，应能看到任务完成状态或历史记录。

## 影响范围
- 所有"一键生成并发布"功能（头条、知乎、微信公众号）。
- 单独的"总结导出"功能未受影响（仍保持原有逻辑，但在生成过程中关闭面板也会中断，后续可考虑同样迁移）。
