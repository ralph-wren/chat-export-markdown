# 小红书标题被清空问题修复 (2026-01-24 v2)

## 问题分析
根据用户反馈和截图，尽管标题填充成功，但在后续填充正文时，标题会被意外清空。
**根本原因**：
1. **`selectAll` 范围过大**：在 `fillContent` 中使用的 `document.execCommand('selectAll')` 在某些情况下会选中整个页面的可编辑区域（包括标题输入框），导致随后的 `delete` 操作将标题一并抹除。
2. **焦点管理失效**：虽然有焦点检查，但 Slate.js 编辑器的复杂 DOM 结构可能导致 `activeElement` 判断不准确。

## 修复措施
1. **局部清空逻辑**：在 [xiaohongshu.ts](file:///c:/Users/ralph/IdeaProject/Memoraid/src/content/xiaohongshu.ts) 的 `fillContent` 中，弃用了 `selectAll` 指令。改为使用 `Selection` 和 `Range` API，精确选中编辑器内部的节点内容进行删除。
2. **强制焦点隔离**：在填充正文前，显式检查当前焦点是否在标题输入框。如果是，则强制将其移至编辑器，确保后续指令不会误伤标题。
3. **引入“标题保护”机制**：在整个填充流程中增加了一道防线——在正文填充完成后，程序会立即再次检查标题栏是否为空。如果发现标题丢失，将自动重新执行一次 `fillTitle` 进行修复。

## 验证情况
- `npm run build` 编译成功。
- 通过逻辑增强和双重保护，确保了标题的持久性。
