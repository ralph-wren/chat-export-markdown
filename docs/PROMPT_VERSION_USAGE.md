# 提示词强制刷新功能使用说明

## 功能概述

已实现提示词版本控制机制，当你修改 `prompts.ts` 中的默认提示词时，所有用户的设置面板会自动更新到最新版本。

## 如何使用

### 1. 修改提示词内容

在 `src/utils/prompts.ts` 文件中修改对应的提示词常量：

- `TOUTIAO_DEFAULT_PROMPT` - 头条号提示词
- `ZHIHU_DEFAULT_PROMPT` - 知乎提示词
- `WEIXIN_DEFAULT_PROMPT` - 微信公众号提示词

### 2. 更新版本号

修改提示词后，**必须同时更新**对应的版本号。在 `prompts.ts` 文件末尾找到：

```typescript
export const PROMPT_VERSIONS = {
  TOUTIAO: '1.0.0',  // ← 修改头条提示词后更新这里
  ZHIHU: '1.0.0',    // ← 修改知乎提示词后更新这里
  WEIXIN: '1.0.0'    // ← 修改微信提示词后更新这里
};
```

版本号建议遵循语义化版本规范：
- 小修改：`1.0.0` → `1.0.1`
- 功能更新：`1.0.1` → `1.1.0`
- 重大变更：`1.1.0` → `2.0.0`

### 3. 自动生效

用户下次打开设置面板时，系统会自动：
1. 检测到版本不匹配
2. 更新提示词内容为最新版本
3. 保存新版本号
4. 在控制台输出日志（例如：`[Prompt Update] 头条提示词已更新到版本: 1.0.1`）

## 示例

假设你要优化头条号的提示词：

### 步骤1：修改提示词
```typescript
// 在 prompts.ts 中修改
export const TOUTIAO_DEFAULT_PROMPT = `## 头条号文章风格指南
... (你的新内容)
`;
```

### 步骤2：更新版本号
```typescript
export const PROMPT_VERSIONS = {
  TOUTIAO: '1.0.1',  // ← 从 1.0.0 更新到 1.0.1
  ZHIHU: '1.0.0',
  WEIXIN: '1.0.0'
};
```

### 步骤3：验证
1. 构建项目：`npm run build`
2. 重新加载浏览器扩展
3. 打开设置面板，检查控制台是否有更新日志
4. 查看头条号提示词是否已更新

## 技术细节

### 存储结构

用户的设置中会包含版本信息：
```typescript
{
  promptVersions: {
    toutiao: '1.0.1',
    zhihu: '1.0.0',
    weixin: '1.0.0'
  }
}
```

### 检查逻辑

每次打开设置面板时，Settings 组件会：
1. 读取本地存储的版本号
2. 与代码中的 `PROMPT_VERSIONS` 对比
3. 如果不匹配，自动更新提示词内容
4. 保存新的版本号

### 注意事项

1. **版本号必须更新**：只修改提示词内容而不更新版本号，用户不会收到更新
2. **会覆盖用户修改**：如果用户自定义了提示词，更新后会被覆盖为新的默认值
3. **初次使用**：对于新安装的用户，会自动初始化为当前最新版本

## 验证清单

在发布更新前，请确认：
- [ ] 修改了提示词内容
- [ ] 更新了对应的版本号
- [ ] 运行 `npm run build` 无错误
- [ ] 在测试环境中验证更新生效
- [ ] 检查控制台日志确认更新执行

## 常见问题

**Q: 我修改了提示词但用户没有更新？**
A: 检查是否同时更新了 `PROMPT_VERSIONS` 中对应的版本号。

**Q: 用户的自定义提示词会被覆盖吗？**
A: 是的，版本更新会覆盖所有用户的提示词。这是设计决策，确保所有用户使用最新优化的提示词。

**Q: 可以回滚到旧版本吗？**
A: 可以，只需要将提示词内容和版本号都改回旧版本即可。

**Q: 版本号格式有要求吗？**
A: 建议使用语义化版本（如 1.0.0），但理论上任何字符串都可以，只要版本号不同就会触发更新。
