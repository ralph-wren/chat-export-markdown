# å°çº¢ä¹¦æŒ‰é’®ç¼ºå¤±é—®é¢˜ä¿®å¤

## é—®é¢˜æè¿°
é¦–é¡µçš„å°çº¢ä¹¦æŒ‰é’®ç¼ºå¤±ï¼Œç”¨æˆ·æ— æ³•ä½¿ç”¨å°çº¢ä¹¦å‘å¸ƒåŠŸèƒ½ã€‚

## åŸå› åˆ†æ
é€šè¿‡ä»£ç æ£€æŸ¥å‘ç°ï¼š
1. é¡¹ç›®ä¸­å·²æœ‰å°çº¢ä¹¦ç›¸å…³çš„å®Œæ•´åŸºç¡€è®¾æ–½ï¼š
   - `src/content/xiaohongshu.ts` - å°çº¢ä¹¦å†…å®¹è„šæœ¬
   - `src/utils/prompts.ts` - åŒ…å« `XIAOHONGSHU_DEFAULT_PROMPT`
   - `src/utils/storage.ts` - åŒ…å«å°çº¢ä¹¦é…ç½®ç»“æ„
   - `src/manifest.ts` - å·²æ³¨å†Œå°çº¢ä¹¦content script

2. ä½†ç¼ºå°‘ä»¥ä¸‹å…³é”®éƒ¨åˆ†ï¼š
   - `src/utils/i18n.ts` - ç¼ºå°‘å°çº¢ä¹¦ç›¸å…³çš„ç¿»è¯‘
   - `src/components/Home.tsx` - ç¼ºå°‘å°çº¢ä¹¦çš„å¤„ç†å‡½æ•°å’ŒUIæŒ‰é’®

## ä¿®å¤æ­¥éª¤

### 1. æ·»åŠ ç¿»è¯‘ï¼ˆi18n.tsï¼‰

åœ¨ `Translation` æ¥å£ä¸­æ·»åŠ ï¼š
- `publishToXiaohongshu: string;` - å‘å¸ƒæŒ‰é’®æ–‡æœ¬  
- `xiaohongshu: string;` - å¹³å°åç§°
- `publishingToXiaohongshu: string;` - å‘å¸ƒçŠ¶æ€æ–‡æœ¬

ä¸ºæ‰€æœ‰è¯­è¨€ç‰ˆæœ¬æ·»åŠ ç¿»è¯‘ï¼š
- **ä¸­æ–‡**: `publishToXiaohongshu: 'å‘å°çº¢ä¹¦'`, `xiaohongshu: 'å°çº¢ä¹¦'`, `publishingToXiaohongshu: 'æ­£åœ¨å‘å¸ƒåˆ°å°çº¢ä¹¦...'`
- **è‹±æ–‡**: `publishToXiaohongshu: 'REDnote'`, `xiaohongshu: 'REDnote'`, `publishingToXiaohongshu: 'Publishing to REDnote...'`
- **æ—¥æ–‡ã€éŸ©æ–‡ã€å¾·æ–‡ã€æ³•æ–‡ã€è¥¿ç­ç‰™æ–‡**: ç±»ä¼¼æ·»åŠ 

### 2. æ·»åŠ Home.tsxåŠŸèƒ½ï¼ˆå¾…å®Œæˆï¼‰

éœ€è¦æ·»åŠ ï¼š

#### 2.1 å¯¼å…¥å›¾æ ‡
```typescript
import { BookHeart } from 'lucide-react';  // å°çº¢ä¹¦å›¾æ ‡
```

#### 2.2 æ·»åŠ å¤„ç†å‡½æ•°

**ä»å·²æœ‰ç»“æœå‘å¸ƒåˆ°å°çº¢ä¹¦**:
```typescript
const handlePublishToXiaohongshu = async () => {
  const settings = await getSettings();
  if (!settings.xiaohongshu?.cookie) {
    if (confirm(t.cookieMissing)) {
      onOpenSettings();
    }
    return;
  }

  setStatus(t.publishingToXiaohongshu);
  try {
    const response = await chrome.runtime.sendMessage({
      type: 'PUBLISH_TO_XIAOHONGSHU',
      payload: {
        title: currentTitle || 'Untitled',
        content: result,
        sourceUrl: currentSourceUrl,
        sourceImages: currentSourceImages
      }
    });

    if (response && response.success) {
      setStatus(t.publishSuccess);
    } else {
      throw new Error(response?.error || 'Unknown error');
    }
  } catch (e: any) {
    console.error(e);
    setStatus(t.publishFailed);
    alert(`${t.publishFailed}: ${e.message}`);
  }
};
```

**ä¸€é”®ç”Ÿæˆå¹¶å‘å¸ƒåˆ°å°çº¢ä¹¦**:
```typescript
const handleGenerateAndPublishToXiaohongshu = async () => {
  const settings = await getSettings();
  if (!settings.xiaohongshu?.cookie) {
    if (confirm(t.cookieMissing)) {
      onOpenSettings();
    }
    return;
  }

  setLoading(true);
  setProgress(5);
  setStatus(t.extractingContent);
  setLogMessage(t.extractingContent);
  setResult(null);
  setErrorMessage(null);
  setConversationHistory([]);
  setUserClosedResult(false);

  try {
    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
    if (!tab.id) throw new Error('No active tab');

    const response = await chrome.runtime.sendMessage({
      type: 'INITIATE_GENERATE_AND_PUBLISH',
      payload: {
        platform: 'xiaohongshu',
        tabId: tab.id
      }
    });

    if (!response?.success) {
      throw new Error(response?.error || 'æ— æ³•å¯åŠ¨åå°ä»»åŠ¡');
    }
  } catch (error: any) {
    console.error(error);
    // é”™è¯¯å¤„ç†é€»è¾‘...
  }
};
```

#### 2.3 æ·»åŠ UIæŒ‰é’®

**é¦–é¡µæŒ‰é’®** (åœ¨å…¬ä¼—å·ã€å¤´æ¡ã€çŸ¥ä¹ä¹‹åæ·»åŠ ):
```tsx
<button
  onClick={handleGenerateAndPublishToXiaohongshu}
  className="flex-1 bg-pink-500 text-white px-2 py-3 rounded-lg flex items-center gap-1 hover:bg-pink-600 transition justify-center"
  title={t.publishToXiaohongshu}
>
  <BookHeart className="w-4 h-4" />
  <span className="text-xs font-medium">{t.publishToXiaohongshu}</span>
</button>
```

**ç»“æœé¡µæŒ‰é’®** (åœ¨å¾®ä¿¡ã€å¤´æ¡ã€çŸ¥ä¹æŒ‰é’®ä¹‹åæ·»åŠ ):
```tsx
<button
  onClick={handlePublishToXiaohongshu}
  className="flex-1 bg-pink-500 text-white py-2 rounded flex items-center justify-center gap-2 hover:bg-pink-600 transition"
  title={t.xiaohongshu}
>
  <BookHeart className="w-4 h-4" />
  <span className="text-xs">{t.xiaohongshu}</span>
</button>
```

## ä¿®å¤çŠ¶æ€
- [x] æ·»åŠ ç¿»è¯‘æ–‡ä»¶
- [x] æ·»åŠ Home.tsxå¤„ç†å‡½æ•°
- [x] æ·»åŠ Home.tsx UIæŒ‰é’®
- [x] æ„å»ºéªŒè¯ âœ… 
- [ ] æµ‹è¯•åŠŸèƒ½ï¼ˆå¾…ç”¨æˆ·æµ‹è¯•ï¼‰

## å·²å®Œæˆå†…å®¹
1. âœ… åœ¨ `i18n.ts` ä¸­ä¸ºæ‰€æœ‰è¯­è¨€ï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ã€å¾·æ–‡ã€æ³•æ–‡ã€è¥¿ç­ç‰™æ–‡ï¼‰æ·»åŠ äº†å°çº¢ä¹¦ç›¸å…³ç¿»è¯‘
2. âœ… åœ¨ `Home.tsx` ä¸­æ·»åŠ äº†ä¸¤ä¸ªå¤„ç†å‡½æ•°ï¼š
   - `handlePublishToXiaohongshu` - ä»å·²æœ‰ç»“æœå‘å¸ƒåˆ°å°çº¢ä¹¦
   - `handleGenerateAndPublishToXiaohongshu` - ä¸€é”®ç”Ÿæˆå¹¶å‘å¸ƒåˆ°å°çº¢ä¹¦
3. âœ… åœ¨é¦–é¡µæ·»åŠ äº†å°çº¢ä¹¦æŒ‰é’®ï¼ˆç²‰è‰²ä¸»é¢˜ï¼ŒBookHeartå›¾æ ‡ï¼‰
4. âœ… åœ¨ç»“æœé¡µæ·»åŠ äº†å°çº¢ä¹¦å‘å¸ƒæŒ‰é’®
5. âœ… è¿è¡Œ `npm run build` éªŒè¯æ— ç¼–è¯‘é”™è¯¯

## å¾…åŠäº‹é¡¹
1. å®ŒæˆHome.tsxçš„ä¿®æ”¹
2. è¿è¡Œ `npm run build` éªŒè¯æ²¡æœ‰ç¼–è¯‘é”™è¯¯
3. æµ‹è¯•å°çº¢ä¹¦å‘å¸ƒåŠŸèƒ½

## ç›¸å…³æ–‡ä»¶
- `src/utils/i18n.ts` - ç¿»è¯‘æ–‡ä»¶ âœ…
- `src/components/Home.tsx` - ä¸»ç»„ä»¶æ–‡ä»¶ ğŸ”„ 
- `src/content/xiaohongshu.ts` - å°çº¢ä¹¦content scriptï¼ˆå·²å­˜åœ¨ï¼‰
- `src/utils/prompts.ts` - æç¤ºè¯é…ç½®ï¼ˆå·²å­˜åœ¨ï¼‰
- `src/utils/storage.ts` - å­˜å‚¨é…ç½®ï¼ˆå·²å­˜åœ¨ï¼‰
