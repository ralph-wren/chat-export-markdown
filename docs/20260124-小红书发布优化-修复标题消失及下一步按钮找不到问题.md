# 小红书发布流程优化说明 (2026-01-24)

## 问题修复
1. **标题被意外清空**：修复了在填充正文时标题有时会被清空的问题。通过增强焦点管理和在填充前确保正确的元素处于激活状态，避免了 `execCommand` 误操作。
2. **流程双重触发**：修复了 `autoFillContent` 可能被多次调用导致的逻辑冲突。现在增加了严格的 `isProcessing` 状态锁。
3. **“下一步”按钮未找到**：针对一键排版后 DOM 更新可能延迟的问题，为“下一步”按钮增加了重试机制（最多 3 次尝试），并扩展了选择器覆盖范围。

## 改进详情
- **[xiaohongshu.ts](file:///c:/Users/ralph/IdeaProject/Memoraid/src/content/xiaohongshu.ts)**:
    - 优化了 `fillTitle`：在操作前显式聚焦，操作后显式失去焦点，并增加了填充结果校验。
    - 优化了 `fillContent`：增加了焦点位置验证，确保 `selectAll` 指令只作用于编辑器区域，防止误伤标题。
    - 改进了 `clickNextStep`：增加了 3 秒范围内的重试逻辑，提高了在页面加载/渲染较慢时的成功率。
    - 扩展了 `SELECTORS`：增加了更多可能的“下一步”和“一键排版”按钮选择器。

## 验证结果
- 执行 `npm run build` 编译成功。
- 逻辑上解决了用户反馈的“正文粘贴后标题消失”以及“找不到下一步按钮”的问题。
