<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡ä»£ç†æœåŠ¡æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            background: #f9f9f9;
        }
        
        .test-card h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
        }
        
        .status.loading {
            background: #ff9800;
            animation: pulse 1s infinite;
        }
        
        .status.success {
            background: #4caf50;
        }
        
        .status.error {
            background: #f44336;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .test-image {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }
        
        .test-image.show {
            display: block;
        }
        
        .test-info {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            font-family: monospace;
        }
        
        .test-url {
            font-size: 11px;
            color: #999;
            word-break: break-all;
            margin-top: 5px;
        }
        
        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .summary {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .summary.show {
            display: block;
        }
        
        .summary h2 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .summary-stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }
        
        .summary-stat {
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¼ï¸ å›¾ç‰‡ä»£ç†æœåŠ¡æµ‹è¯•</h1>
        <p class="subtitle">æµ‹è¯•ä¸åŒçš„ä»£ç†æœåŠ¡è·å–å¾®åšå›¾ç‰‡çš„æ•ˆæœ</p>
        
        <button onclick="runTests()" id="testBtn">ğŸš€ å¼€å§‹æµ‹è¯•</button>
        
        <div class="summary" id="summary">
            <h2>æµ‹è¯•ç»“æœ</h2>
            <div class="summary-stats">
                <div class="summary-stat">
                    <span>âœ… æˆåŠŸ:</span>
                    <strong id="successCount">0</strong>
                </div>
                <div class="summary-stat">
                    <span>âŒ å¤±è´¥:</span>
                    <strong id="failCount">0</strong>
                </div>
                <div class="summary-stat">
                    <span>â±ï¸ æ€»è€—æ—¶:</span>
                    <strong id="totalTime">0s</strong>
                </div>
            </div>
        </div>
        
        <div class="test-grid" id="testGrid"></div>
    </div>
    
    <script>
        const testUrl = 'https://wx3.sinaimg.cn/large/460462c1ly1i9dj5x93lvj20u01xkths.jpg';
        
        const tests = [
            {
                name: 'ç›´æ¥è®¿é—®ï¼ˆé¢„æœŸå¤±è´¥ï¼‰',
                url: testUrl,
                description: 'ä¸ä½¿ç”¨ä»»ä½•ä»£ç†ï¼Œç›´æ¥è®¿é—®å¾®åšå›¾ç‰‡'
            },
            {
                name: 'images.weserv.nl ä»£ç†',
                url: `https://images.weserv.nl/?url=${encodeURIComponent(testUrl.replace(/^https?:\/\//, ''))}`,
                description: 'ä½¿ç”¨ weserv.nl å›¾ç‰‡ä»£ç†æœåŠ¡'
            },
            {
                name: 'imageproxy.pimg.tw ä»£ç†',
                url: `https://imageproxy.pimg.tw/resize?url=${encodeURIComponent(testUrl)}`,
                description: 'ä½¿ç”¨ pimg.tw å›¾ç‰‡ä»£ç†æœåŠ¡'
            }
        ];
        
        function createTestCard(test, index) {
            return `
                <div class="test-card" id="card-${index}">
                    <h3>
                        <span class="status" id="status-${index}"></span>
                        ${test.name}
                    </h3>
                    <p style="font-size: 13px; color: #666; margin-bottom: 10px;">${test.description}</p>
                    <img class="test-image" id="img-${index}" alt="Test Image">
                    <div class="test-info" id="info-${index}">ç­‰å¾…æµ‹è¯•...</div>
                    <div class="test-url">${test.url.substring(0, 80)}...</div>
                </div>
            `;
        }
        
        async function testImage(test, index) {
            const statusEl = document.getElementById(`status-${index}`);
            const imgEl = document.getElementById(`img-${index}`);
            const infoEl = document.getElementById(`info-${index}`);
            
            statusEl.className = 'status loading';
            infoEl.textContent = 'æµ‹è¯•ä¸­...';
            
            const startTime = Date.now();
            
            return new Promise((resolve) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                
                const timeout = setTimeout(() => {
                    statusEl.className = 'status error';
                    infoEl.textContent = 'âŒ è¶…æ—¶ï¼ˆ10ç§’ï¼‰';
                    resolve(false);
                }, 10000);
                
                img.onload = () => {
                    clearTimeout(timeout);
                    const duration = ((Date.now() - startTime) / 1000).toFixed(2);
                    statusEl.className = 'status success';
                    infoEl.textContent = `âœ… æˆåŠŸ | ${img.width}x${img.height} | ${duration}s`;
                    imgEl.src = img.src;
                    imgEl.classList.add('show');
                    resolve(true);
                };
                
                img.onerror = () => {
                    clearTimeout(timeout);
                    const duration = ((Date.now() - startTime) / 1000).toFixed(2);
                    statusEl.className = 'status error';
                    infoEl.textContent = `âŒ åŠ è½½å¤±è´¥ | ${duration}s`;
                    resolve(false);
                };
                
                img.src = test.url;
            });
        }
        
        async function runTests() {
            const btn = document.getElementById('testBtn');
            const grid = document.getElementById('testGrid');
            const summary = document.getElementById('summary');
            
            btn.disabled = true;
            btn.textContent = 'â³ æµ‹è¯•ä¸­...';
            grid.innerHTML = tests.map((test, i) => createTestCard(test, i)).join('');
            summary.classList.remove('show');
            
            const startTime = Date.now();
            let successCount = 0;
            let failCount = 0;
            
            for (let i = 0; i < tests.length; i++) {
                const success = await testImage(tests[i], i);
                if (success) {
                    successCount++;
                } else {
                    failCount++;
                }
                
                // ç­‰å¾…ä¸€ä¸‹å†æµ‹è¯•ä¸‹ä¸€ä¸ª
                if (i < tests.length - 1) {
                    await new Promise(r => setTimeout(r, 500));
                }
            }
            
            const totalTime = ((Date.now() - startTime) / 1000).toFixed(2);
            
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('failCount').textContent = failCount;
            document.getElementById('totalTime').textContent = totalTime + 's';
            summary.classList.add('show');
            
            btn.disabled = false;
            btn.textContent = 'ğŸ”„ é‡æ–°æµ‹è¯•';
        }
        
        // è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>
